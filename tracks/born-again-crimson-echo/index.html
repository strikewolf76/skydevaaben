<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>After Br端gge - Born Again (Crimson Echo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">

  <meta property="og:type" content="music.song">
  <meta property="og:site_name" content="Skydevaaben">
  <meta property="og:title" content="After Br端gge - Born Again (Crimson Echo)">
  <meta property="og:description" content="Tap to open in Spotify.">
  <meta property="og:url" content="https://skydevaaben.no/tracks/born-again-crimson-echo/index.html">
  <meta property="og:image" content="https://skydevaaben.no/assets/og/born-again-ab-cover.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="After Br端gge - Born Again (Crimson Echo)">
  <meta name="twitter:description" content="Tap to open in Spotify.">
  <meta name="twitter:image" content="https://skydevaaben.no/assets/og/born-again-ab-cover.jpg">

  <style>
    body {
      background: url('https://skydevaaben.no/assets/og/born-again-ab-cover-bg.jpg') no-repeat center center;
      background-size: cover;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      text-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.35);
      border-radius: 16px;
      padding: 24px 24px 32px 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      max-width: 340px;
    }
    .cover {
      width: 280px;
      height: 280px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.5);
      margin-bottom: 20px;
    }
    .track-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 6px;
      text-align: center;
    }
    .track-subtitle {
      font-size: 1rem;
      opacity: 0.85;
      margin-bottom: 18px;
      text-align: center;
    }
    .service-buttons {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .cta {
      background: rgba(0,0,0,0.7);
      color: white;
      border: 2px solid white;
      text-decoration: none;
      padding: 14px 22px;
      font-size: 18px;
      border-radius: 10px;
      transition: background 0.3s ease;
      text-align: center;
    }
    .cta:hover {
      background: rgba(0,0,0,0.9);
    }
    .cta.spotify-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      color: #191414;
      border: none;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 8px;
      padding: 12px 0;
      box-shadow: 0 2px 8px rgba(30,215,96,0.10);
      transition: background 0.2s;
      gap: 10px;
    }
    .cta.spotify-btn:hover {
      background: #1ed760;
      color: #191414;
    }
    .spotify-logo {
      display: flex;
      align-items: center;
    }
    .spotify-text {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    .consent-info {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 20px;
      max-width: 480px;
      line-height: 1.4;
      text-align: center;
    }
  </style>
</head>

<body>

  <div class="content">
    <img src="https://skydevaaben.no/assets/og/born-again-ab-cover-fg.jpg" alt="" class="cover">
    <div class="track-title">After Br端gge - Born Again (Crimson Echo)</div>
    <div class="track-subtitle">Choose your preferred music service</div>
    <div class="service-buttons">
      <a class="cta spotify-btn" href="https://open.spotify.com/track/4frsd6XAetZDMgLB3aKLUi" data-dest="spotify" rel="noopener noreferrer">
        <span class="spotify-logo">
          <svg width="28" height="28" viewBox="0 0 168 168"><circle fill="#1ED760" cx="84" cy="84" r="84"/><path d="M120.1 116.6c-1.7 2.8-5.3 3.7-8.1 2-22.2-13.6-50.2-16.7-83.2-9.2-3.2.7-6.4-1.3-7.1-4.5-.7-3.2 1.3-6.4 4.5-7.1 35.7-7.9 66.1-4.4 90.2 10.5 2.8 1.7 3.7 5.3 2 8.3zm11.5-23.1c-2.1 3.4-6.5 4.5-9.9 2.4-25.5-15.6-64.5-20.1-94.7-11.1-3.8 1.1-7.8-1.1-8.9-4.9-1.1-3.8 1.1-7.8 4.9-8.9 33.9-9.8 76.1-5 104.7 12.2 3.4 2.1 4.5 6.5 2.4 9.9zm12.7-25.2c-30.1-18.1-79.7-19.8-108.1-11.1-4.4 1.3-9-1.2-10.3-5.6-1.3-4.4 1.2-9 5.6-10.3 31.9-9.5 85.2-7.6 119.6 12.3 4 2.4 5.3 7.7 2.9 11.7-2.4 4-7.7 5.3-11.7 2.9z" fill="#fff"/></svg>
        </span>
        <span class="spotify-text">Play</span>
      </a>
    </div>
  </div>

  <p id="consent-info" class="consent-info" style="display:none;">
    This link uses measurement to improve campaigns. By continuing, you agree.
  </p>

<script>
(function () {
  var DESTINATIONS = [{"key":"spotify","baseUrl":"https://open.spotify.com/track/4frsd6XAetZDMgLB3aKLUi","spotifyId":"4frsd6XAetZDMgLB3aKLUi"}];
  var META_PIXEL_ID = "802257822837167";
  var TRACK_SLUG = "born-again-crimson-echo";
  var UTM_CAMPAIGN = "born-again-crimson-echo";
  var UTM_CONTENT_DEFAULT = "meta";

  var params = new URLSearchParams(window.location.search || "");
  var CID = params.get("cid") || "";
  var consentGranted = false;
  var pixelEventsQueued = [];
  var clickLocked = false;
  var pageViewFired = false;

  // Allow known social crawlers to fetch OG tags (no redirect)
  var ua = navigator.userAgent || "";
  var isCrawler = /(facebookexternalhit|facebot|twitterbot|linkedinbot|discordbot|pinterest|slackbot|whatsapp|telegrambot|skypeuripreview)/i.test(ua);
  var isInAppBrowser = /(FBAN|FBAV|Instagram|Messenger|Line|TikTok)/i.test(ua);
  if (isCrawler) return;

  // Helper functions
  function hasConsent() {
    try {
      return localStorage.getItem("sv_cookie_consent") === "granted";
    } catch (_) {
      return false;
    }
  }

  function setConsentGranted() {
    if (consentGranted) return;
    consentGranted = true;
    try {
      localStorage.setItem("sv_cookie_consent", "granted");
    } catch (_) {}
    if (typeof window.fbq === "function" && META_PIXEL_ID) {
      fbq("consent", "grant");
      // Fire queued events
      while (pixelEventsQueued.length > 0) {
        var ev = pixelEventsQueued.shift();
        ev();
      }
    }
  }

  function showConsentNoticeIfNeeded() {
    if (!hasConsent()) {
      var consentInfoEl = document.getElementById("consent-info");
      if (consentInfoEl) consentInfoEl.style.display = "block";
    }
  }

  function firePageViewOnce() {
    if (pageViewFired) return;
    if (typeof window.fbq !== "function" || !META_PIXEL_ID) return;
    pageViewFired = true;
    try { fbq("track", "PageView"); } catch (_) {}
  }

  // Show consent notice for new users
  showConsentNoticeIfNeeded();

  // Initialize Meta Pixel (if ID present)
  if (META_PIXEL_ID) {
    !(function (f, b, e, v, n, t, s) {
      if (f.fbq) return;
      n = f.fbq = function () { n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments); };
      if (!f._fbq) f._fbq = n;
      n.push = n; n.loaded = !0; n.version = "2.0"; n.queue = [];
      t = b.createElement(e); t.async = !0; t.src = v;
      s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s);
    })(window, document, "script", "https://connect.facebook.net/en_US/fbevents.js");

    fbq("init", META_PIXEL_ID);
    
    // If returning user: grant immediately and fire PageView
    if (hasConsent()) {
      setConsentGranted();
      firePageViewOnce();
    } else {
      // Queue PageView until consent granted
      pixelEventsQueued.push(function () { firePageViewOnce(); });
    }
  }

  function appendUtms(url, utms) {
    var u = new URL(url);
    Object.keys(utms).forEach(function(k) {
      if (utms[k]) u.searchParams.set(k, utms[k]);
    });
    return u.toString();
  }

  function fireOutboundSpotify(kind, destKey, dest) {
    if (typeof window.fbq !== "function" || !META_PIXEL_ID) return;
    try {
      var eventId = "ob_" + Date.now() + "_" + Math.random().toString(16).slice(2);
      fbq("trackCustom", "OutboundSpotify", {
        kind: kind,
        cid: CID || "",
        slug: TRACK_SLUG || "",
        dest: destKey === "spotify" ? "spotify" : destKey,
        channel: "meta",
        track_id: (dest && dest.spotifyId) ? dest.spotifyId : "",
        utm_campaign: UTM_CAMPAIGN || "",
        utm_content: (CID || UTM_CONTENT_DEFAULT || "")
      }, { eventID: eventId });
    } catch (_) {}
  }

  function handleClick(destKey, e) {
    // Allow modified clicks (open in new tab etc.)
    if (e && (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.button === 1)) return;

    if (clickLocked) return;

    if (e && e.preventDefault) e.preventDefault();

    var dest = DESTINATIONS.find(d => d.key === destKey);
    if (!dest) return;

    clickLocked = true;

    var webUrl = appendUtms(dest.baseUrl, { utm_campaign: UTM_CAMPAIGN, utm_content: (CID || UTM_CONTENT_DEFAULT) });

    if (!hasConsent()) {
      setConsentGranted();
    }
    firePageViewOnce();
    fireOutboundSpotify("click", destKey, dest);

    try {
      if (navigator.sendBeacon && META_PIXEL_ID) {
        navigator.sendBeacon("https://www.facebook.com/tr/", new Blob([], { type: "application/x-www-form-urlencoded" }));
      }
    } catch (_) {}
    
    // Always redirect to web URL (instant in in-app browsers; short delay elsewhere)
    if (isInAppBrowser) {
      window.location.href = webUrl;
    } else {
      setTimeout(function () { window.location.href = webUrl; }, 120);
    }
  }

  // Attach click handlers
  document.querySelectorAll('.cta').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      var destKey = this.getAttribute('data-dest');
      handleClick(destKey, e);
    });
  });

})();
</script>

</body>
</html>
