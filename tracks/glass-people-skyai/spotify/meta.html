<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Sky.AI - Glass People</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">

  <meta property="og:type" content="music.song">
  <meta property="og:site_name" content="Skydevaaben">
  <meta property="og:title" content="Sky.AI - Glass People">
  <meta property="og:description" content="Tap to open in Spotify.">
  <meta property="og:url" content="https://skydevaaben.no/tracks/glass-people-skyai/spotify/meta.html">
  <meta property="og:image" content="https://skydevaaben.no/assets/og/glass-people-skyai.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Sky.AI - Glass People">
  <meta name="twitter:description" content="Tap to open in Spotify.">
  <meta name="twitter:image" content="https://skydevaaben.no/assets/og/glass-people-skyai.jpg">

  <style>
    body {
      background: url('https://skydevaaben.no/assets/og/glass-people-skyai-bg.jpg') no-repeat center center;
      background-size: cover;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .cta {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: 2px solid white;
      text-decoration: none;
      padding: 14px 22px;
      font-size: 18px;
      border-radius: 10px;
      transition: background 0.3s ease;
      text-align: center;
    }

    .cta:hover {
      background: rgba(0, 0, 0, 0.9);
    }

    .cta.spotify-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      color: #191414;
      border: none;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 8px;
      padding: 12px 0;
      box-shadow: 0 2px 8px rgba(30, 215, 96, 0.10);
      transition: background 0.2s;
      gap: 10px;
    }

    .cta.spotify-btn:hover {
      background: #1ed760;
      color: #191414;
    }

    .spotify-logo {
      display: flex;
      align-items: center;
    }

    .spotify-text {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .consent-info {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 20px;
      max-width: 480px;
      line-height: 1.4;
      text-align: center;
    }

    .meta {
      text-align: center;
      margin: 14px 0 6px;
    }

    .meta .artist {
      font-size: 16px;
      opacity: 0.95;
    }

    .meta .song {
      font-size: 22px;
      font-weight: 700;
      line-height: 1.2;
    }

    .hint {
      margin: 10px 0 14px;
      font-size: 14px;
      opacity: 0.9;
      text-align: center;
    }

    .cta.spotify-btn {
      width: min(420px, 92vw);
      padding: 14px 18px;
      cursor: pointer;
      user-select: none;
    }

    .cta.spotify-btn .spotify-logo,
    .cta.spotify-btn .spotify-text {
      pointer-events: none;
      /* ensure click always hits <a> */
    }

    .content {
      width: 100%;
      max-width: 520px;
    }

    .cover {
      width: min(320px, 86vw);
      height: min(320px, 86vw);
    }
  </style>
</head>

<body>

  <div class="content">
    <img src="https://skydevaaben.no/assets/og/glass-people-skyai-fg.jpg" alt="" class="cover">
    <div class="meta">
      <div class="artist">Sky.AI</div>
      <div class="song">Glass People</div>
    </div>

    <div class="hint">Choose your preferred music service</div>

    <a class="cta spotify-btn" href="#" data-dest="spotify" rel="noopener noreferrer">
      <span class="spotify-logo" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 168 168">
          <circle fill="#1ED760" cx="84" cy="84" r="84" />
          <path
            d="M120.1 116.6c-1.7 2.8-5.3 3.7-8.1 2-22.2-13.6-50.2-16.7-83.2-9.2-3.2.7-6.4-1.3-7.1-4.5-.7-3.2 1.3-6.4 4.5-7.1 35.7-7.9 66.1-4.4 90.2 10.5 2.8 1.7 3.7 5.3 2 8.3z"
            fill="#fff" />
          <path
            d="M131.6 93.5c-2.1 3.4-6.5 4.5-9.9 2.4-25.5-15.6-64.5-20.1-94.7-11.1-3.8 1.1-7.8-1.1-8.9-4.9-1.1-3.8 1.1-7.8 4.9-8.9 33.9-9.8 76.1-5 104.7 12.2 3.4 2.1 4.5 6.5 2.4 9.9z"
            fill="#fff" />
          <path
            d="M144.3 68.3c-30.1-18.1-79.7-19.8-108.1-11.1-4.4 1.3-9-1.2-10.3-5.6-1.3-4.4 1.2-9 5.6-10.3 31.9-9.5 85.2-7.6 119.6 12.3 4 2.4 5.3 7.7 2.9 11.7-2.4 4-7.7 5.3-11.7 2.9z"
            fill="#fff" />
        </svg>
      </span>
      <span class="spotify-text">Play on Spotify</span>
    </a>

  </div>

  <p id="consent-info" class="consent-info" style="display:none;">
    This link uses measurement to improve campaigns. By continuing, you agree.
  </p>

  <script>
    (function () {
      var DESTINATIONS = [{ "key": "spotify", "baseUrl": "https://open.spotify.com/track/530YM22qICcy0vap1EFWJH", "spotifyId": "530YM22qICcy0vap1EFWJH" }];
      var META_PIXEL_ID = "802257822837167";
      var TRACK_SLUG = "glass-people-skyai";
      var UTM_CAMPAIGN = "glass-people-skyai";
      var UTM_CONTENT_DEFAULT = "meta-ads-reel02";

      var params = new URLSearchParams(window.location.search || "");
      var CID = params.get("cid") || "";
      var consentGranted = false;
      var pixelEventsQueued = [];
      var clickLocked = false;
      var pageViewFired = false;

      // Allow known social crawlers to fetch OG tags (no redirect)
      var ua = navigator.userAgent || "";
      var isCrawler = /(facebookexternalhit|facebot|twitterbot|linkedinbot|discordbot|pinterest|slackbot|whatsapp|telegrambot|skypeuripreview)/i.test(ua);
      var isInAppBrowser = /(FBAN|FBAV|Instagram|Messenger|Line|TikTok)/i.test(ua);
      if (isCrawler) return;

      // Check existing consent
      var hasConsent = false;
      try {
        hasConsent = localStorage.getItem("sv_cookie_consent") === "granted";
      } catch (_) { }

      // Show consent info for new users
      if (!hasConsent) {
        var consentInfoEl = document.getElementById("consent-info");
        if (consentInfoEl) consentInfoEl.style.display = "block";
      }

      function firePageView() {
        if (pageViewFired) return;
        if (typeof fbq !== "function" || !META_PIXEL_ID) return;
        pageViewFired = true;
        try { fbq("track", "PageView"); } catch (_) { }
      }

      // Grant consent (once only)
      function grantConsent() {
        if (consentGranted) return;
        consentGranted = true;
        try {
          localStorage.setItem("sv_cookie_consent", "granted");
        } catch (_) { }
        if (typeof fbq === "function" && META_PIXEL_ID) {
          fbq("consent", "grant");
          // Fire queued events
          while (pixelEventsQueued.length > 0) {
            var ev = pixelEventsQueued.shift();
            ev();
          }
        }
      }

      // Initialize Meta Pixel (if ID present)
      if (META_PIXEL_ID) {
        !(function (f, b, e, v, n, t, s) {
          if (f.fbq) return;
          n = f.fbq = function () { n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments); };
          if (!f._fbq) f._fbq = n;
          n.push = n; n.loaded = !0; n.version = "2.0"; n.queue = [];
          t = b.createElement(e); t.async = !0; t.src = v;
          s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s);
        })(window, document, "script", "https://connect.facebook.net/en_US/fbevents.js");

        fbq("init", META_PIXEL_ID);

        // If returning user: grant immediately and fire PageView
        if (hasConsent) {
          grantConsent();
          firePageView();
        } else {
          // Queue PageView until consent granted
          pixelEventsQueued.push(function () { firePageView(); });
        }
      }

      function appendUtms(url, utms) {
        var u = new URL(url);
        Object.keys(utms).forEach(function (k) {
          if (utms[k]) u.searchParams.set(k, utms[k]);
        });
        return u.toString();
      }

      function trackOutbound(destKey, dest) {
        if (typeof fbq !== "function" || !META_PIXEL_ID) return;
        try {
          var eventId = "ob_" + Date.now() + "_" + Math.random().toString(16).slice(2);
          fbq("trackCustom", "OutboundSpotify", {
            kind: "click",
            cid: CID || "",
            slug: TRACK_SLUG || "",
            dest: destKey === "spotify" ? "spotify" : destKey,
            channel: "meta",
            track_id: (dest && dest.spotifyId) ? dest.spotifyId : "",
            utm_campaign: UTM_CAMPAIGN || "",
            utm_content: (CID || UTM_CONTENT_DEFAULT || "")
          }, { eventID: eventId });
        } catch (_) { }
      }

      function handleClick(destKey, e) {
        // Allow modified clicks (open in new tab etc.)
        if (e && (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.button === 1)) return;

        if (clickLocked) return;

        if (e && e.preventDefault) e.preventDefault();

        var dest = DESTINATIONS.find(d => d.key === destKey);
        if (!dest) return;

        clickLocked = true;
        clickLocked = true;
        setTimeout(function () { clickLocked = false; }, 5000);


        var webUrl = appendUtms(dest.baseUrl, { utm_campaign: UTM_CAMPAIGN, utm_content: (CID || UTM_CONTENT_DEFAULT) });

        grantConsent();     // alltid p√• klikk (trygg, idempotent)
        firePageView();
        trackOutbound(destKey, dest);

        // 1) Try Spotify app only for Spotify destination (and only if we have an ID)
        if (destKey === "spotify" && dest.spotifyId && !isInAppBrowser) {
          setTimeout(function () {
            window.location.href = "spotify:track:" + dest.spotifyId;
          }, 200);
        }

        // 2) Always fallback to web URL
        setTimeout(function () {
          window.location.href = webUrl;
        }, 1300);
      }

      // Attach click handlers
      document.querySelectorAll('.cta').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          var destKey = this.getAttribute('data-dest');
          handleClick(destKey, e);
        });
      });

    })();
  </script>

</body>

</html>